<?php $controller = $block->getCustomUrl();
    echo $block->getButtonHtml();
 ?>
 <script type="text/javascript">
        require(['jquery', 'jquery/ui'], function($){
            jQuery(document).ready( function() {
            	jQuery("#row_prime_data_connection_general_synchronisation div").remove();
        		var validate = jQuery("#prime_data_connect_step1_validate_value").val();
            	var catalog = jQuery("#prime_data_connect_step2_custom_dropdown").val();
            	var synchronizationStatus = jQuery("#prime_data_connect_step2_synchronization_status").val();

    			if(validate == 1 && catalog != 0 && synchronizationStatus == ""){
    				jQuery("#row_prime_data_connect_general_startsyncbuttonfield").show();
    				jQuery('#prime_data_connect_step2-head').show();
                    jQuery('#prime_data_connect_step2-state').val(1);
    			}else{
                    jQuery("#row_prime_data_connect_general_startsyncbuttonfield").hide();
                }
                /* ========Batch processing=========*/
                jQuery("#start_sync_button").click(function(){
                	var validate = jQuery("#prime_data_connect_Step1_validate_value").val();
                	var catalog = jQuery("#prime_data_connect_step2_custom_dropdown").val();
                	var synchronizationStatus = jQuery("#prime_data_connect_step2_synchronization_status").val();
        			if(validate == 1 && catalog != 0 && synchronizationstatus == ""){
                        jQuery(this).hide();
                    	process_step(1);
                	}
                });
                  function process_step(step) {
                    jQuery("#row_prime_data_connect_general_synchronisation").append('<div class="ajaxmsg">Data synchronizing.</div>').addClass('ajxmsg-padg');
                    jQuery.ajax({
                        url: "<?php echo $block->getUrl('primedataconnect/actionajax/syncData'); ?>",
                        type: "POST",
                        data: {step:step},
                        success: function(response){
                            jQuery("#row_prime_data_connect_general_synchronisation div").remove();
                            jQuery("#row_prime_data_connect_general_synchronisation").append('<div class="ajaxmsg">Data synchronized.</div>');
                            location.reload();
                        }
                    }).fail(function (response) {
                        if ( window.console && window.console.log ) {
                            console.log( response );
                        }
                    });
                }
            /* ========Batch processing=========*/
            });
        });
 </script>


